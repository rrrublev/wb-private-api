# Тесты для wb-private-api

## Обзор тестов

### Существующие тесты
- `WBPrivateAPI.test.js` - Основные тесты API методов
- `WBProduct.getStocks.test.js` - Детальное тестирование получения остатков товаров
- `Utils.test.js` - Тесты утилитарных функций

### Новые тесты URL (Constants.js)

#### 1. `Constants.URLs.test.js` - Основное тестирование URL
**Назначение**: Проверка доступности и корректности всех URL из файла Constants.js

**Что тестируется**:
- ✅ Доступность URL главного меню
- ✅ URL изображений и каталога брендов
- ✅ URL информации о поставщиках, их каталогов и отгрузок
- ✅ URL карточек товаров, продавцов, деталей, отзывов и вопросов
- ✅ URL поиска, похожих товаров, рекламы и подсказок
- ✅ URL изображений товаров всех размеров
- ✅ URL промо-акций
- ✅ Валидация структуры URL и плейсхолдеров

**Тестовые данные**:
```javascript
const TEST_DATA = {
  products: { valid: [177899980, 60059650, 304390393, 67858518] },
  suppliers: { valid: [1136572, 18740, 206198, 244907] },
  brands: { valid: [244907, 206198] },
  keywords: ["швабра zetter", "футболка", "телефон"]
};
```

#### 2. `Constants.URLs.integration.test.js` - Интеграционное тестирование
**Назначение**: Проверка соответствия URL реальным методам API

**Что тестируется**:
- ✅ Соответствие URL поиска методу `search()`
- ✅ Соответствие URL поставщика методам `getSupplierInfo()`, `SupplierTotalProducts()`
- ✅ Соответствие URL товара методам `WBProduct`
- ✅ Соответствие URL изображений `Utils.Card.imageURL()`
- ✅ Соответствие URL отзывов методу `getFeedbacks()`
- ✅ Соответствие URL вопросов методу `getQuestions()`
- ✅ Проверка актуальности версий API (v13, v8, v4, etc.)
- ✅ Проверка корректности доменов
- ✅ Проверка обязательных параметров

#### 3. `Constants.URLs.utils.test.js` - Утилитарное тестирование
**Назначение**: Проверка корректности формирования URL с динамическими параметрами

**Что тестируется**:
- ✅ Корректное построение URL карточки товара
- ✅ Корректное построение URL изображений товара
- ✅ Корректное построение URL поставщика
- ✅ Корректное построение URL отзывов с партициями
- ✅ Валидация замены всех плейсхолдеров
- ✅ Проверка протоколов (HTTPS)
- ✅ Проверка разрешенных доменов
- ✅ Обработка граничных случаев (короткие/длинные ID)
- ✅ Обработка некорректных данных
- ✅ Обработка специальных символов

## Запуск тестов

### Все тесты
```bash
npm test
```

### Только тесты URL
```bash
# Основное тестирование URL
npx jest tests/Constants.URLs.test.js --verbose

# Интеграционное тестирование
npx jest tests/Constants.URLs.integration.test.js --verbose

# Утилитарное тестирование
npx jest tests/Constants.URLs.utils.test.js --verbose

# Все тесты URL
npx jest tests/Constants.URLs --verbose
```

### С детальным выводом
```bash
npm test -- --verbose --detectOpenHandles
```

## Структура тестовых данных

### Товары для тестирования
- `177899980` - Товар с корзиной 12, используется в Utils.test.js
- `60059650` - Товар для поиска похожих, используется в WBPrivateAPI.test.js  
- `304390393` - Товар для списков, используется в WBPrivateAPI.test.js
- `67858518` - Швабра Zetter, используется в примерах JSON

### Поставщики для тестирования
- `1136572` - Поставщик из WBPrivateAPI.test.js
- `18740` - Поставщик для каталога из WBPrivateAPI.test.js
- `206198` - Поставщик Zetter из фильтров
- `244907` - Бренд Zetter из фильтров

### Ключевые слова
- `"швабра zetter"` - Основной поисковый запрос из тестов
- `"футболка"` - Запрос для множественного тестирования
- `"телефон"` - Дополнительный запрос

## Ожидаемые результаты

### Успешные тесты (✅)
- URL структурно корректны
- Плейсхолдеры заменяются правильно
- Версии API актуальны
- Домены соответствуют Wildberries

### Предупреждения (⚠️)
- Некоторые URL могут быть временно недоступны (404)
- API может возвращать ошибки для тестовых данных
- Это нормальное поведение, тесты не должны падать

### Критические ошибки (❌)
- Неправильная структура URL
- Некорректные плейсхолдеры
- Использование HTTP вместо HTTPS
- Неправильные домены

## Добавление новых тестов

### Для нового URL в Constants.js:
1. Добавить URL в соответствующий раздел `Constants.URLs.test.js`
2. Добавить тестовые данные в `TEST_DATA`
3. Создать тест проверки доступности
4. Добавить интеграционный тест в `Constants.URLs.integration.test.js`

### Для нового метода API:
1. Добавить проверку соответствия URL в `Constants.URLs.integration.test.js`
2. Убедиться что метод использует правильные константы
3. Добавить тест валидации параметров

## Полезные команды

### Запуск с покрытием
```bash
npx jest --coverage
```

### Запуск в watch режиме
```bash
npx jest --watch
```

### Запуск конкретного теста
```bash
npx jest -t "Проверка URL изображений товаров"
```

### Отладка тестов
```bash
npx jest --verbose --no-cache --detectOpenHandles
```